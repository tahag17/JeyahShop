<div
  class="min-h-screen flex flex-col bg-bgLight dark:bg-bgDark transition-colors duration-300 p-6"
>
  <!-- üîÑ Loading Overlay -->
  <div
    *ngIf="loading"
    class="fixed inset-0 bg-black/40 dark:bg-black/60 flex items-center justify-center z-50"
  >
    <i class="fa-solid fa-spinner fa-spin text-white text-5xl"></i>
  </div>

  <!-- Back Button -->
  <button
    (click)="goBack()"
    class="mb-6 px-4 py-2 bg-accentTail/20 hover:bg-accentTail/40 rounded-md text-textLight dark:text-textDark w-max transition"
  >
    <i class="fa-solid fa-arrow-left mr-2"></i> Retour √† la liste
  </button>

  <!-- Error Message -->
  <div *ngIf="error" class="text-center text-dangerTail mb-4">
    {{ error }}
  </div>

  <!-- Product Card -->
  <div
    *ngIf="product && !loading"
    class="max-w-4xl mx-auto bg-surfaceLight dark:bg-surfaceDark rounded-2xl shadow-md dark:shadow-lg overflow-hidden transition-all duration-300"
  >
    <!-- Images -->
    <!-- Images -->
    <div
      class="flex flex-wrap gap-2 p-4 justify-center bg-gray-50 dark:bg-gray-800"
    >
      <ng-container
        *ngIf="product.imageUrls && product.imageUrls.length; else noImageIcon"
      >
        <ng-container *ngFor="let img of product.imageUrls; let i = index">
          <img
            [src]="img"
            [alt]="product.name + ' image ' + (i + 1)"
            (error)="onImageError($event)"
            class="w-32 h-32 object-cover rounded-md border border-gray-200 dark:border-gray-700"
          />
        </ng-container>
      </ng-container>

      <ng-template #noImageIcon>
        <div
          class="w-32 h-32 flex items-center justify-center bg-gray-200 dark:bg-gray-700 rounded-md border border-gray-300 dark:border-gray-600"
        >
          <i
            class="fa-solid fa-image text-gray-400 dark:text-gray-500 text-3xl"
          ></i>
        </div>
      </ng-template>
    </div>

    <!-- Product Info -->
    <div class="p-6 flex flex-col gap-4">
      <!-- Name -->
      <h2 class="text-3xl font-bold text-primaryTail dark:text-primaryDarkTail">
        {{ product.name }}
      </h2>

      <!-- Rating -->
      <div class="flex items-center gap-2 text-yellow-400">
        <ng-container *ngFor="let star of [1, 2, 3, 4, 5]">
          <i class="text-lg" [ngClass]="getStarClass(product.rate, star)"></i>
        </ng-container>
        <span class="text-textLight dark:text-textDark text-sm">
          ({{ product.rate | number : "1.1-2" }})
        </span>
      </div>

      <!-- Price & Availability -->
      <div class="flex flex-wrap items-center gap-4">
        <span class="text-xl font-semibold text-textLight dark:text-textDark"
          >{{ product.price }} DH</span
        >
        <span
          [ngClass]="{
            'text-successTail': product.available,
            'text-dangerTail': !product.available
          }"
          class="font-medium"
        >
          {{ product.available ? "En stock" : "Rupture" }}
        </span>
      </div>

      <!-- Category & Stock -->
      <div class="flex flex-wrap gap-6 text-textLight dark:text-textDark">
        <p><strong>Cat√©gorie:</strong> {{ categoryName || "Chargement..." }}</p>
        <p><strong>Quantit√© en stock:</strong> {{ product.stockQuantity }}</p>
      </div>

      <!-- Description -->
      <div class="mt-4 text-textLight dark:text-textDark">
        <h3 class="font-semibold mb-2">Description</h3>
        <p>{{ product.description }}</p>
      </div>

      <!-- Add to Cart -->
      <button
        class="mt-6 w-full flex items-center justify-center gap-2 px-4 py-2 bg-primaryTail text-white rounded-lg hover:bg-primaryTail/80 transition disabled:opacity-50"
        [disabled]="!product.available"
        (click)="addToCart(product.id)"
      >
        <i class="fa-solid fa-cart-shopping"></i> Ajouter au panier
      </button>

      <!-- Success / Error Toast -->
      <div *ngIf="message" class="text-center text-successTail mt-2">
        {{ message }}
      </div>
      <div *ngIf="error" class="text-center text-dangerTail mt-2">
        {{ error }}
      </div>
    </div>
  </div>
</div>
