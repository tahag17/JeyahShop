<div
  class="max-w-7xl mx-auto p-6 bg-surfaceLight dark:bg-surfaceDark rounded-xl shadow-md space-y-4"
>
  <!-- Header -->
  <h2
    class="text-3xl font-heading font-bold text-primaryTail dark:text-primaryDarkTail mb-4"
  >
    Gestion des commandes
  </h2>

  <!-- Loading & Error -->
  <div *ngIf="loading" class="text-center text-textLight dark:text-textDark">
    Chargement...
  </div>
  <div *ngIf="error" class="text-center text-dangerTail mb-4">{{ error }}</div>

  <!-- Orders Cards Flex Container -->
  <div
    *ngIf="!loading && orders.length"
    class="flex flex-wrap gap-4 justify-start"
  >
    <div
      *ngFor="let order of orders"
      class="flex-1 min-w-[280px] max-w-[32%] bg-surfaceLight dark:bg-surfaceDark rounded-lg shadow-md p-4 flex flex-col gap-3 border border-accentTail/20 dark:border-accentDarkTail/20"
    >
      <!-- Order Header -->
      <div class="flex justify-between items-center">
        <span
          class="font-semibold text-primaryTail dark:text-primaryDarkTail text-lg"
        >
          Commande #{{ order.id }}
        </span>
        <span
          class="font-semibold"
          [ngClass]="{
            'text-successTail': order.status === 'PENDING',
            'text-warningTail': order.status === 'SHIPPED',
            'text-infoTail': order.status === 'DELIVERED',
            'text-dangerTail': order.status === 'CANCELLED'
          }"
        >
          {{ order.status }}
        </span>
      </div>

      <!-- Order Info -->
      <div
        class="flex flex-col sm:flex-row sm:justify-between gap-2 text-textLight dark:text-textDark text-sm sm:text-base"
      >
        <div>
          <span class="font-semibold text-primaryTail dark:text-primaryDarkTail"
            >Utilisateur:</span
          >
          {{ order.userEmail }}
        </div>
        <div>
          <span class="font-semibold text-primaryTail dark:text-primaryDarkTail"
            >Total:</span
          >
          {{ order.totalPrice }} €
        </div>
      </div>

      <!-- Custom Status Dropdown -->
      <div class="relative w-full mt-2">
        <button
          (click)="order.isDropdownOpen = !order.isDropdownOpen"
          [ngClass]="{
            'text-successTail': order.status === 'PENDING',
            'text-warningTail': order.status === 'SHIPPED',
            'text-infoTail': order.status === 'DELIVERED',
            'text-dangerTail': order.status === 'CANCELLED'
          }"
          class="w-full px-2 py-1 border rounded bg-white dark:bg-gray-800 text-sm flex justify-between items-center focus:outline-none focus:ring-2 focus:ring-accentTail dark:focus:ring-accentDarkTail"
        >
          {{ order.status }}
          <i class="fa-solid fa-chevron-down ml-2"></i>
        </button>

        <div
          *ngIf="order.isDropdownOpen"
          class="absolute z-10 mt-1 w-full bg-surfaceLight dark:bg-surfaceDark border border-gray-300 dark:border-gray-700 rounded shadow-lg"
        >
          <div
            *ngFor="let s of orderStatuses"
            (click)="
              order.status = s;
              requestStatusChange(order.id, s);
              order.isDropdownOpen = false
            "
            [ngClass]="{
              'text-successTail': s === 'PENDING',
              'text-warningTail': s === 'SHIPPED',
              'text-infoTail': s === 'DELIVERED',
              'text-dangerTail': s === 'CANCELLED'
            }"
            class="px-2 py-1 cursor-pointer hover:bg-accentTail/20 dark:hover:bg-accentDarkTail/20 rounded transition"
          >
            {{ s }}
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- No Orders -->
  <div
    *ngIf="!loading && !orders.length"
    class="text-center text-textLight dark:text-textDark"
  >
    Aucune commande trouvée.
  </div>

  <!-- Pagination -->
  <div
    *ngIf="!loading && totalPages > 1"
    class="flex justify-center gap-4 mt-4 items-center text-textLight dark:text-textDark"
  >
    <button
      class="px-3 py-1 bg-accentTail/20 dark:bg-accentDarkTail/20 rounded hover:bg-accentTail/40 dark:hover:bg-accentDarkTail/40 transition disabled:opacity-50"
      [disabled]="currentPage === 0"
      (click)="goToPage(currentPage - 1)"
    >
      Précédent
    </button>

    <span>Page {{ currentPage + 1 }} / {{ totalPages }}</span>

    <button
      class="px-3 py-1 bg-accentTail/20 dark:bg-accentDarkTail/20 rounded hover:bg-accentTail/40 dark:hover:bg-accentDarkTail/40 transition disabled:opacity-50"
      [disabled]="currentPage + 1 === totalPages"
      (click)="goToPage(currentPage + 1)"
    >
      Suivant
    </button>
  </div>
</div>

<!-- Confirm Modal -->
<div
  *ngIf="isConfirmModalOpen && confirmChange"
  class="fixed inset-0 flex items-center justify-center bg-black bg-opacity-50 backdrop-blur-sm z-50"
>
  <div
    class="bg-surfaceLight dark:bg-surfaceDark rounded-lg p-6 w-96 shadow-lg text-center text-textLight dark:text-textDark"
  >
    <h3
      class="text-xl font-bold mb-4 text-primaryTail dark:text-primaryDarkTail"
    >
      Confirmer le changement
    </h3>

    <p class="mb-4">
      Voulez-vous vraiment changer le statut de la commande
      <strong>#{{ confirmChange.id }}</strong> vers
      <span class="font-semibold text-accentTail dark:text-accentDarkTail">{{
        confirmChange.newStatus
      }}</span>
      ?
    </p>

    <div class="flex justify-center gap-4 mt-6">
      <button
        (click)="confirmStatusChange()"
        class="px-4 py-2 bg-successTail text-white rounded hover:bg-successTail/80 transition"
      >
        ✅ Confirmer
      </button>
      <button
        (click)="closeConfirmModal()"
        class="px-4 py-2 bg-dangerTail text-white rounded hover:bg-dangerTail/80 transition"
      >
        ❌ Annuler
      </button>
    </div>
  </div>
</div>
